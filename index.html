<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>BlueStream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Streaming film dan series gratis">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0a0f1f;
      color: #fff;
    }
    header {
      position: sticky;
      top: 0;
      background: #0d1b3d;
      padding: 12px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    input {
      flex: 1;
      padding: 10px;
      border-radius: 6px;
      border: none;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 14px;
      padding: 16px;
    }
    .card {
      cursor: pointer;
    }
    .card img {
      width: 100%;
      border-radius: 10px;
    }
    .card h4 {
      margin: 6px 0 0;
      font-size: 14px;
    }
    .detail {
      padding: 16px;
    }
    .back {
      margin-bottom: 12px;
      display: inline-block;
      color: #4da3ff;
      cursor: pointer;
    }
    iframe {
      width: 100%;
      height: 220px;
      border-radius: 10px;
      border: none;
      margin-top: 12px;
    }
  </style>
</head>
<body>

<header>
  <input id="search" placeholder="Search film / series..." />
</header>

<div id="app"></div>

<script>
const API = 'https://zeldvorik.ru/apiv3/api.php';
const app = document.getElementById('app');
const searchInput = document.getElementById('search');

/* ================= HOME ================= */
async function loadHome() {
  app.innerHTML = '<div class="grid">Loading...</div>';

  const res = await fetch(`${API}?action=trending&page=1`);
  const data = await res.json();

  app.innerHTML = `
    <div class="grid">
      ${data.items.map(item => `
        <div class="card" onclick="goDetail('${item.detailPath}')">
          <img src="${item.poster}">
          <h4>${item.title}</h4>
        </div>
      `).join('')}
    </div>
  `;
}

/* ================= DETAIL ================= */
async function loadDetail(detailPath) {
  app.innerHTML = 'Loading detail...';

  const res = await fetch(`${API}?action=detail&detailPath=${detailPath}`);
  const data = await res.json();
  const item = data.item || data;

  app.innerHTML = `
    <div class="detail">
      <div class="back" onclick="goHome()">← Kembali</div>
      <h2>${item.title}</h2>
      <p>${item.genre} • ⭐ ${item.rating}</p>
      <img src="${item.poster}" style="width:200px;border-radius:10px">
      <p>${item.description || ''}</p>

      ${item.playerUrl ? `
        <iframe src="${item.playerUrl}" allowfullscreen></iframe>
      ` : ''}
    </div>
  `;
}

/* ================= ROUTER ================= */
function router() {
  const hash = location.hash;

  if (hash.startsWith('#/detail/')) {
    const detailPath = hash.replace('#/detail/', '');
    loadDetail(detailPath);
  } else {
    loadHome();
  }
}

function goDetail(path) {
  location.hash = '#/detail/' + path;
}

function goHome() {
  location.hash = '';
}

/* ================= SEARCH ================= */
let debounce;
searchInput.addEventListener('input', () => {
  clearTimeout(debounce);
  debounce = setTimeout(async () => {
    const q = searchInput.value.trim();
    if (!q) return loadHome();

    app.innerHTML = 'Searching...';
    const res = await fetch(`${API}?action=search&q=${q}`);
    const data = await res.json();

    app.innerHTML = `
      <div class="grid">
        ${data.items.map(item => `
          <div class="card" onclick="goDetail('${item.detailPath}')">
            <img src="${item.poster}">
            <h4>${item.title}</h4>
          </div>
        `).join('')}
      </div>
    `;
  }, 400);
});

/* INIT */
window.addEventListener('load', router);
window.addEventListener('hashchange', router);
</script>

</body>
</html>
